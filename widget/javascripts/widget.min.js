var KoleoWidget={KNOWN_STATIONS:{},SPECIAL_CHAR_REGEXP:/[_|\/|\s]+/g,MULTI_SEPARATOR_REGEXP:/[\-]+/g,TRIM_SEPARATOR_REGEXP:/^-+|-+$/g,TRIM_WHITESPACE_REGEXP:/^(\s|\u00A0)+|(\s|\u00A0)+$/g,MULTI_WHITESPACE_REGEXP:/\s+/g,POLISH_CHARS:[/[ąĄ]/g,/[ćĆ]/g,/[ęĘ]/g,/[łŁ]/g,/[ńŃ]/g,/[óÓ]/g,/[śŚ]/g,/[żŻ]/g,/[źŹ]/g],POLISH_CHAR_REPLACEMNETS:["a","c","e","l","n","o","s","z","z"],SEPARATOR:"-",SPACE:" ",EMPTY:"",TYPE_UNDEFINED:"undefined",initAll:function(t){var e=this;$(t).each(function(){$(this).data("already-added")||($(this).data("already-added",!0),e.init($(this)))})},init:function(t){var e=this;this.insertWidget(t),this.addStyles(),this.bindDatePicker(t),this.showLiveSearch(t),$(t).find("form.koleo-widget").on("submit",function(a){a.preventDefault();var i={start:$(t).find(".start_station"),end:$(t).find(".end_station")},s=e.KNOWN_STATIONS[i.start.val().trim().toLocaleLowerCase()],n=e.KNOWN_STATIONS[i.end.val().trim().toLocaleLowerCase()];if(s)if(n){var o=e.formatDate($(t).find(".date").val()),l=new Date(o);isNaN(l.valueOf())&&(l=new Date);var r=("0"+l.getDate()).slice(-2)+"-"+("0"+(l.getMonth()+1)).slice(-2)+"-"+l.getFullYear()+"_"+("0"+l.getUTCHours()).slice(-2)+":00",d=$(t).data("brands"),c="all/"+(d?d+"--"+d:"all")+"/auto";window.location="https://bilety.polregio.pl/wyniki/"+s+"/"+n+"/"+r+"/*/departure/"+c}else i.end.focus();else i.start.focus()})},insertWidget:function(t){var e="";!0!==$(t).data("no-text")&&(e=""),e+='<form class="koleo-widget"><div class="flex-item"><input class="start_station" name="start_station" type="text" placeholder="Stacja Odjazdu" aria-label="Stacja Odjazdu" autocomplete="off"></div><div class="flex-item"><input class="end_station" aria-label="Stacja Docelowa" name="end_station" type="text" placeholder="Stacja Przyjazdu" autocomplete="off"></div><div class="flex-item"><input class="date" name="date" type="text" placeholder="KIEDY" autocomplete="off" aria-label="Data połączenia" ></div><div class="flex-item"><input class="submit" type="submit" value="Znajdź" aria-label="Znajdź"></div></form>';var a=$(t),i=this;a.append(e),i.resizeContainer(a),$(window).resize(function(){i.resizeContainer(a)})},addStyles:function(){var t=$("<link>",{rel:"stylesheet",type:"text/css",href:"widget/stylesheets/widget.min.css?v=20211022"}),e=$("<link>",{rel:"stylesheet",type:"text/css",href:"https://fonts.googleapis.com/css?family=Noto+Sans"});t.appendTo("head"),e.appendTo("head")},showLiveSearch:function(t){$(t).find(".start_station, .end_station").awesomecomplete({noResultsMessage:"Nie ma takiej stacji.",dataMethod:this.getData(this),valueFunction:function(t){return t.name},renderFunction:function(t){return'<p class="title">'+t.name+"</p>"},highlightMatches:!1,typingDelay:200})},getData:function(t){return function(e,a,i){$.ajax({url:"https://bilety.polregio.pl/ls.js?callback=?",type:"js",dataType:"jsonp",data:{q:e},success:function(e){e.stations.forEach(function(e){t.KNOWN_STATIONS[e.name.toLocaleLowerCase()]=e.ibnr}),i(e.stations)},error:function(t){i([])}})}},bindDatePicker:function(t){var e=$(t).find(".date"),a=new Date,i=a.getFullYear(),s=a.getMonth(),n=a.getDate(),o=a.getHours(),l=new Date(i,s,n-1,o),r=new Date(i,s,n,o),d=new Date(l);d.setDate(d.getDate()+90),e.fdatepicker({initialDate:r,format:"dd-mm-yyyy hh:ii",language:"pl",weekStart:1,minView:1,startDate:l,endDate:d})},formatDate:function(t){var e=t.substr(0,2),a=t.substr(3,2);return t.split(" ")[0].split("-").pop()+"-"+a+"-"+e+"T"+t.split(" ").pop()+"+00:00"},parameterize:function(t,e){for(var a=0;a<this.POLISH_CHARS.length;a++)t=t.replace(this.POLISH_CHARS[a],this.POLISH_CHAR_REPLACEMNETS[a]);return e&&"number"==typeof e&&(t=t.replace(this.TRIM_WHITESPACE_REGEXP,this.EMPTY).replace(this.MULTI_WHITESPACE_REGEXP,this.SPACE).split(this.SPACE).join(this.SPACE)),t.replace(this.SPECIAL_CHAR_REGEXP,this.SEPARATOR).replace(this.MULTI_SEPARATOR_REGEXP,this.SEPARATOR).replace(this.TRIM_SEPARATOR_REGEXP,this.EMPTY).replace(".",this.SEPARATOR).toLowerCase()},resizeContainer:function(t){t.width()>800?t.addClass("koleo-wide-widget"):t.removeClass("koleo-wide-widget")}};